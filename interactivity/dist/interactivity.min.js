!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Interactivity=e()}(this,(function(){"use strict";class t{constructor(t,e,r){this.options={minOpacity:.5,...r};const i=e.style.getImage(t);i&&i.data&&(this.sdf=i.sdf,this.width=i.data.width,this.height=i.data.height,this.layerIconData=i.data,this.pixelRatio=i.pixelRatio,this.mask=this.create())}imageData(){if(this.layerIconData&&this.height&&this.width)return new ImageData(Uint8ClampedArray.from(this.layerIconData.data),this.width,this.height)}create(t=this.options.minOpacity){if(!this.width||!this.height||!this.layerIconData)return[];const e=[],r=100*t;for(let t=3;t<this.layerIconData.data.length;t+=4)e.push(this.layerIconData.data[t]>=r);return e}readCoord(t,e,r=0){const i=(t,e)=>{if(this.height&&this.width&&this.mask&&e<this.height&&t<this.width&&e>=0&&t>=0&&this.mask[t+e*this.width])return!0};if(i(t,e))return!0;if(!(r>0))return!1;{let n,o,s,a;for(n=-1*r;n<r;n++)for(o=-1*r;o<r;o++)if(s=t+n,a=e+o,i(s,a))return!0}}}const e={fill:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' xml:space='preserve'%3E%3Cpath d='M20.38 17.17V4.83A2.49 2.49 0 0 0 22 2.5 2.5 2.5 0 0 0 19.5 0c-1.07 0-1.98.68-2.33 1.63H4.83A2.486 2.486 0 0 0 2.5 0 2.5 2.5 0 0 0 0 2.5c0 1.07.68 1.98 1.63 2.33v1.33C.68 6.52 0 7.43 0 8.5A2.5 2.5 0 0 0 2.5 11c1.07 0 1.98-.68 2.33-1.63h3.33c.25.67.78 1.21 1.46 1.46v6.33C8.68 17.52 8 18.43 8 19.5a2.5 2.5 0 0 0 2.5 2.5c1.07 0 1.98-.68 2.33-1.63h4.33c.36.95 1.27 1.63 2.34 1.63a2.5 2.5 0 0 0 2.5-2.5c0-1.07-.68-1.98-1.62-2.33zm-3.21 1.46h-4.33c-.25-.67-.78-1.21-1.46-1.46v-6.33C12.32 10.48 13 9.57 13 8.5A2.5 2.5 0 0 0 10.5 6c-1.07 0-1.98.68-2.33 1.63H4.83c-.25-.68-.78-1.21-1.45-1.46V4.83c.67-.25 1.21-.78 1.46-1.46h12.33c.25.67.78 1.21 1.46 1.46v12.33c-.68.26-1.21.79-1.46 1.47zM9.75 8.5c0-.41.34-.75.75-.75s.75.34.75.75-.34.75-.75.75-.75-.34-.75-.75zm9.75-6.75c.41 0 .75.34.75.75s-.34.75-.75.75-.75-.34-.75-.75.34-.75.75-.75zm-17 0c.41 0 .75.34.75.75s-.34.75-.75.75-.75-.34-.75-.75.34-.75.75-.75zm0 7.5c-.41 0-.75-.34-.75-.75s.34-.75.75-.75.75.34.75.75-.34.75-.75.75zm8 11c-.41 0-.75-.34-.75-.75s.34-.75.75-.75.75.34.75.75-.34.75-.75.75zm9 0c-.41 0-.75-.34-.75-.75s.34-.75.75-.75.75.34.75.75-.34.75-.75.75z'/%3E%3C/svg%3E",line:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' xml:space='preserve'%3E%3Cpath d='M1 21v-3c.48 0 .94-.02 1.37-.06l.25 2.99C2.1 20.98 1.55 21 1 21zM4.82 20.59l-.7-2.92c.88-.21 1.65-.53 2.3-.94l1.61 2.53c-.92.59-2 1.04-3.21 1.33zm5.05-2.91L7.6 15.72c.5-.58.87-1.27 1.1-2.06l2.88.85c-.36 1.21-.93 2.27-1.71 3.17zm2.11-5.46-2.99-.19c0-.18.01-.36.01-.53 0-.95.08-1.81.23-2.63l2.95.56c-.12.62-.18 1.32-.18 2.07 0 .24-.01.48-.02.72zm.68-4.37L9.91 6.64c.5-1.13 1.21-2.12 2.11-2.92l1.99 2.24c-.58.52-1.02 1.14-1.35 1.89zm2.69-2.78L14 2.39c.94-.47 2.03-.83 3.22-1.06l.57 2.95c-.93.18-1.75.44-2.44.79zM19.6 4.05l-.2-3C19.9 1.02 20.44 1 21 1v3c-.49 0-.96.02-1.4.05z'/%3E%3C/svg%3E",symbol:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' style='enable-background:new 0 0 22 22' xml:space='preserve'%3E%3Ccircle cx='11' cy='11' r='4'/%3E%3C/svg%3E",circle:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' style='enable-background:new 0 0 22 22' xml:space='preserve'%3E%3Ccircle cx='11' cy='11' r='11'/%3E%3C/svg%3E"};class r{constructor(t){this._color=this._rgbaToColors(this._colorToRgba(t))}set color(t){this._color=this._rgbaToColors(this._colorToRgba(t))}get hex(){return"#"+[this._color.red,this._color.green,this._color.blue].map((t=>("00"+t.toString(16)).slice(-2))).join("")}set alpha(t){this._color.alpha=t}get alpha(){return this._color.alpha}get rgbaString(){return`rgba(${this._color.red}, ${this._color.green}, ${this._color.blue}, ${this._color.alpha})`}get rgba(){return{red:this._color.red,green:this._color.green,blue:this._color.blue,alpha:this._color.alpha}}get array(){return[this._color.red,this._color.green,this._color.blue,this._color.alpha]}_colorToRgba(t){"string"==typeof(t=t.toLowerCase())&&t.match(/^[0-9a-f]{6}$/)&&(t="#"+t);const e=document.createElement("canvas").getContext("2d");if(!e)throw new Error("Color cannot be parsed");e.fillStyle=t;const r=e.fillStyle;let i;if("#"===r.substring(0,1))i=`rgba(${parseInt(e.fillStyle.substring(1,3),16)}, ${parseInt(e.fillStyle.substring(3,5),16)}, ${parseInt(e.fillStyle.substring(5,7),16)}, 1)`;else{if("rgba"!==r.substring(0,4))throw new Error("Color cannot be parsed");i=r}return i}_rgbaToColors(t){const e=new RegExp("rgba\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3}),(\\d?\\.?\\d){1,}\\)"),r=t.replace(/\s/g,"").match(e);if(!r)throw new Error("Color cannot be parsed");const[i,n,o,s,a]=r;return{red:parseInt(n,10),green:parseInt(o,10),blue:parseInt(s,10),alpha:parseFloat(a)}}}const i=(t,e,i)=>{const n=e.style.getImage(t);if(!n)throw new Error("Image not found");const s=new ImageData(Uint8ClampedArray.from(n.data.data),n.data.width,n.data.height),a=new o;if(a.updateImageData(s,n.pixelRatio),i){const t=new r(i),e=a.colorMask(t.rgbaString,s);a.updateImageData(e,n.pixelRatio)}return a};class n{constructor(t){this._svgUrl="string"==typeof t?t:this._toUrl(t)}toElement(t=this._svgUrl){const e=new RegExp("^data:image/svg\\+xml,","i"),r=new RegExp("%[A-Fa-f0-9]{2,2}","g");let i=t;if(i.match(e)){i=i.replace(e,"");const t=i.match(r)||[];i=t.filter(((t,e,r)=>e===r.indexOf(t))).reduce(((t,e)=>{const r=new RegExp(e,"g");return t.replace(r,String.fromCharCode(parseInt(e.substring(1),16)))}),i)}const n=document.createElement("span");return n.innerHTML=i,n.children[0]}get dataUrl(){return this._toUrl()}_toUrl(t=this._svgUrl){if("string"==typeof t)return this._svgUrl;return"data:image/svg+xml,"+["%","#","{","}","<",">"].reduce(((t,e)=>{const r=new RegExp(e,"g"),i=("%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).toUpperCase();return t.replace(r,i)}),t.outerHTML).replace(/"/g,"'")}recolor(t,e,i){const o=this.toElement();return[...o.children].forEach((n=>{const o=(t,e)=>{const i=n.getAttribute(t);let o,s=-1;if(s=i?e.map((t=>t[0])).indexOf(i):e.map((t=>t[0])).indexOf(void 0),s>-1)if(o=e[s][1],void 0!==o){const e=new r(o);n.setAttribute(t,e.hex),n.setAttribute(t+"-opacity",e.alpha.toString())}else i&&(n.removeAttribute(t),n.removeAttribute(t+"-opacity"))};if(t&&o("fill",t),e&&o("stroke",e),i&&"circle"===n.nodeName){let t=n.getAttribute("r");t&&n.setAttribute("r",(parseInt(t,10)-i).toString()),n.setAttribute("stroke-width",i.toString())}})),new n(o)}async addToMap(t,e,r,i,n=window.devicePixelRatio){let o;try{o=await this.toImageData(r,i,n)}catch(t){throw t}if(e.hasImage(t))return!1;{const r=window.devicePixelRatio;return e.addImage(t,o,{pixelRatio:r}),!0}}toImageData(t,e,r){return new Promise(((i,n)=>{const o=document.createElement("canvas"),s=o.getContext("2d"),a=new Image;t*=r,e*=r,o.width=t,o.height=e,a.onload=()=>{if(s){s.drawImage(a,0,0,t,e);const r=s.getImageData(0,0,t,e);i(r)}else n("Unable to create content")},a.src=this.dataUrl}))}}class o{constructor(t=new Image){this._img=t}_getCanvas(t,e){const r=document.createElement("canvas"),i=r.getContext("2d");if(t=r.height=t||this._img.naturalHeight||this._img.offsetHeight||this._img.height,e=r.width=e||this._img.naturalWidth||this._img.offsetWidth||this._img.width,i&&r.height>0&&r.width>0)return i.drawImage(this._img,0,0,e,t),r;throw new Error("Unable to create content")}get dataUrl(){return this._getCanvas().toDataURL()}updateImageData(t,e=window.devicePixelRatio){const r=document.createElement("canvas"),i=r.getContext("2d");r.width=t.width,r.height=t.height,i&&(i.putImageData(t,0,0),this._img.width=t.width/e,this._img.height=t.height/e,this._img.src=r.toDataURL())}get displayedImageData(){return this._getImageData()}get element(){return this._img}_getImageData(t,e){const r=this._getCanvas(t,e),i=r.getContext("2d");if(i){return i.getImageData(0,0,r.width,r.height)}throw new Error("Unable to create content")}colorMask(t,e=this.displayedImageData){const i=new r(t).array,n=[];for(let t=0;t<e.data.length;t++){const r=t%4;n.push(3===r?e.data[t]:i[r])}return new ImageData(Uint8ClampedArray.from(n),e.width,e.height)}setContrastingBackgroundColor(t=5){const e=()=>{const e=this.displayedImageData,r=e?((t,e)=>{if(e<1)throw new Error("blockSize must be greater than 0");let r=0,i=0;for(let n=0;n<t.data.length;n+=4*e){let[e,o,s,a]=[t.data[n],t.data[n+1],t.data[n+2],t.data[n+3]];r+=a/255*(.299*e+.587*o+.114*s),i+=a/255}return Math.round(r/i)})(e,t):0,i=r<127.5?255:0;return this._img.style.backgroundColor=`rgba(${i},${i},${i},1)`,this};this._img.complete?e():this._img.onload=e}}const s={container:document.createElement("div"),style:{version:8,glyphs:"{fontstack}/{range}.pbf",sources:{blank:{type:"geojson",data:{type:"FeatureCollection",features:[]}}},layers:[]}};class a{constructor(t){this._map=new t.Map(s)}evaluateText(t,e,r){const i=document.createElement("p");return this._evaluate(t,e,r).then((t=>i.textContent=t.map((t=>t.text)).join(""))),i}evaluateHtml(t,e,r,i){const n=i?i.style._availableImages:[],o=document.createElement("div");return this._evaluate(t,e,r,void 0,n).then((t=>{t.forEach((t=>o.appendChild(this._sectionToHtml(t,i))))})).catch((t=>{})),o}_sectionToHtml(t,e){const r=document.createElement("span");if(r.textContent=t.text||null,t.fontStack&&(r.style.fontFamily=t.fontStack),t.scale&&(r.style.fontSize=100*t.scale+"%"),t.textColor&&(r.style.color=t.textColor),e&&t.image&&e.hasImage(t.image)){const i=this._drawIcon(t.image,t.image,e);i&&r.appendChild(i)}return r}async _evaluate(t,e,r,i,n){const o=Math.random().toString(32).substring(2);this._map.addLayer({id:o,source:"blank",type:"symbol",layout:{"text-field":t}}),await new Promise((t=>this._map.once("styledata",(()=>t()))));const s=this._map.getLayer(o),a=s.layout&&s.layout._values["text-field"].evaluate({properties:e,state:r},r,i,n).sections||[];return this._map.removeLayer(o),a}_drawIcon(t,e,r){const n=i(t,r);return e&&e.toString&&(n.element.title=n.element.alt=e.toString()),n.element}}class l{constructor(t,e,r){const i={closeButton:!0,closeOnClick:!0,closeOnMove:!1,focusAfterOpen:!0,pointer:"pointer",tolerance:3,formatter:this._formatter.bind(this),templater:this._templater.bind(this),highlightFeature:!1};if(e.highlightFeature){const t="object"==typeof e.highlightFeature?e.highlightFeature:{};e.highlightFeature={highlightColor:"#00ffff",opacity:void 0,layerName:Math.random().toString(36).substring(2),layerConfig:void 0,...t}}"tooltip"===e.type&&(i.anchor="top-left",i.focusAfterOpen=!1),e.formatter||e.templater||(this._expressionTemplate=new a(r)),this.options={...i,...e},this.popupTemplate=t,this.popup=new r.Popup(this.options)}showing(){return this.popup.isOpen}showMulti(t,e,r,i,n){if(!this.options.multiFormatter)throw new Error("No multiFormatter found");this._show(t,this.options.multiFormatter(e,this.popupTemplate,i,n,this.popup),r)}show(t,e,r,i,n,o=!1!==this.options.highlightFeature){this._show(t,(this.options.formatter||this._formatter)(e,this.popupTemplate,i,n),r),i&&o&&(this.highlightFeature(e,i),this.popup.on("close",(t=>console.log("CLOSED"))))}highlightFeature(t,e){var i;if(t.id=t.id||Math.floor(100*Math.random()),t.state.hover=!0,"object"!=typeof this.options.highlightFeature)throw new Error("Invalid type of highlight layer:"+typeof this.options.highlightFeature);const n=this.options.highlightFeature,o=new r(n.highlightColor);o.alpha=n.opacity?n.opacity:o.alpha;const s=t.layer.type;let a,l,h,u;"symbol"===s?a=null===(i=t.layer.layout["icon-image"])||void 0===i?void 0:i.name:"circle"===s?l=t.layer.paint["circle-radius"]:"line"===s&&(h=t.layer.paint["line-width"],u=t.layer.layout);const p=t=>Object.keys(t).map((e=>[e,t[e]])).filter((t=>void 0!==t[1]&&null!==t[1])).reduce(((t,e)=>({...t,[e[0]]:e[1]})),{}),c={circle:{type:"circle",paint:p({"circle-color":o.hex,"circle-radius":l,"circle-opacity":o.alpha})},fill:{type:"fill",paint:p({"fill-color":o.hex,"fill-opacity":o.alpha})},line:{type:"line",paint:p({"line-color":o.hex,"line-width":h,"line-opacity":o.alpha}),layout:p(u||{})},symbol:{type:"symbol",layout:{"icon-image":a},paint:p({"icon-color":n.highlightColor,"icon-opacity":o.alpha})}},f=t.toJSON();return n.layerName||(n.layerName=Math.random().toString(36).substring(2)),e.addSource(n.layerName,{type:"geojson",data:f}),e.addLayer({...c[s]||c.circle,minzoom:0,maxzoom:20,...n.layerConfig||{},id:n.layerName,source:n.layerName}),this.popup.once("close",(()=>{n.layerName&&(e.getLayer(n.layerName)&&e.removeLayer(n.layerName),e.getSource(n.layerName)&&e.removeSource(n.layerName))})),n.layerName}_show(t,e,r){r instanceof HTMLElement?r.appendChild(e):(this.popup.setDOMContent(e),this.popup.setLngLat(t),this.popup.addTo(r))}_templater(t,e,r){if("string"==typeof t)return this._simpleTemplater(t,e.properties);if(this._expressionTemplate)return this._expressionTemplate.evaluateHtml(t,e.properties,e.state,r);throw new Error("Cannot load expression template")}_simpleTemplater(t,e){const r=document.createElement("span");return Object.keys(e).forEach((r=>{const i=new RegExp("{"+r+"}","g");t=t.replace(i,e[r])})),r.textContent=t,r}_formatter(t,e,r){const i=this.options.templater||this._templater,n=(e,n)=>{const o=document.createElement(e);let s=i(n,t,r);return"string"==typeof s?o.textContent=s:o.appendChild(s),o},o=document.createElement("div");if(void 0===e)throw new Error("The default Popup Formatter requires a template");if("string"==typeof e)o.appendChild(n("p",e));else if(e instanceof HTMLElement)o.appendChild(e);else{if(e.header){const t=o.appendChild(n("strong",e.header));o.appendChild(t)}if(e.body)if(e.body instanceof HTMLElement)o.appendChild(e.body);else{const t=o.appendChild(n("div",e.body));o.appendChild(t)}if(e.footer){const t=o.appendChild(n("div",e.footer));o.appendChild(t)}}return o}}const h=t=>{if(t)return`rgba(${Math.round(255*t.r)},${Math.round(255*t.g)},${Math.round(255*t.b)},${t.a})`};function u(t,e,r,i,n){if(!r||!i)throw new Error("activePopups is required for the default multi popup");const o=document.createElement("div");o.classList.add("maplibregl-popup-content-multipopup");const s=document.createElement("ul"),a=p(t,r,i,n);return Object.keys(a).forEach((t=>{const e=document.createElement("li");e.textContent=t;const i=c(a[t],r,o);e.appendChild(i),s.appendChild(e)})),o.appendChild(s),o}const p=(t,e,i,n)=>t.map((t=>{var o,s;const a=null===(o=i.get("popup"))||void 0===o?void 0:o.get(t.layer.id);let l=h(t.layer.paint[t.layer.type+"-color"])||h(t.layer.paint["icon-color"]);if(l&&void 0!==t.layer.paint[t.layer.type+"-opacity"]){const e=new r(l);e.alpha=t.layer.paint[t.layer.type+"-opacity"],l=e.rgbaString}let u,p=h(t.layer.paint["circle-stroke-color"])||h(t.layer.paint["fill-outline-color"]);if(p&&void 0!==t.layer.paint["circle-stroke-opacity"]){const e=new r(p);e.alpha=t.layer.paint["circle-stroke-opacity"],p=e.rgbaString}p&&(u=t.layer.paint["circle-stroke-width"]||1);const c=document.createElement("div");let f,g,y="",d=t.layer.id;return a&&(a.show([0,0],t,c,e,void 0,!1),y=[...c.children[0].children].map((t=>t.textContent)).filter((t=>t&&t.trim().length))[0]||"",""===y.trim()&&(y=t.layer.type+" Feature"),d=a.options.groupName||d,f=a.options.icon,"symbol"===t.layer.type&&(g=null===(s=t.layer.layout["icon-image"])||void 0===s?void 0:s.name),null==n||n.on("open",(t=>a.popup.fire("open",t))),null==n||n.on("close",(t=>a.popup.fire("close",t)))),{groupName:d,groupIcon:f,symbolIcon:g,popup:a,primaryKeys:null==a?void 0:a.options.primaryKeys,iconColor:l,iconStroke:p,iconStrokeWidth:u,content:c,textContent:y,feature:t}})).reduce(((t,e)=>(e.popup&&(t[e.groupName]=t[e.groupName]||[],t[e.groupName].push(e)),t)),{}),c=(t,s,a)=>{const l=document.createElement("ul");return t.forEach((t=>{const h=document.createElement("li"),u=document.createElement("a"),p=t.symbolIcon||t.groupIcon;let c;if(p)try{c=i(p,s,t.iconColor)}catch(t){c=void 0}if(!c){let i=new n(e[t.feature.layer.type]||e.symbol);if(t.iconColor){const e=new r(t.iconColor).rgbaString,n=t.iconStroke&&new r(t.iconStroke).rgbaString;i=i.recolor([[void 0,e]],n&&"circle"===t.feature.layer.type?[[void 0,n]]:void 0,t.iconStrokeWidth)}c=new o,c.element.src=i.dataUrl}c.setContrastingBackgroundColor(5),u.textContent=" "+t.textContent,u.href="#",u.tabIndex=0,u.addEventListener("click",(e=>{e.preventDefault(),f(t,a,s)}),!1),h.appendChild(c.element),h.appendChild(u),l.appendChild(h)})),l},f=(t,e,r)=>{const i=[...e.children];let n;r&&t.popup.options.highlightFeature&&(n=t.popup.highlightFeature(t.feature,r));const o=()=>{r&&n&&(r.getLayer(n)&&r.removeLayer(n),r.getSource(n)&&r.removeSource(n))};t.popup.popup.once("close",(t=>{o()}));const s=document.createElement("a");s.href="",s.addEventListener("click",(t=>{t.preventDefault(),[...e.children].forEach((t=>e.removeChild(t))),i.forEach((t=>e.appendChild(t))),o()}),!1),s.textContent="« Back",[...e.children].forEach((t=>e.removeChild(t))),e.appendChild(t.content),e.appendChild(s)};
/**
     * splaytree v3.1.2
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
function g(t,e){var r,i,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var y=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function d(t,e){return t>e?1:t<e?-1:0}function m(t,e,r){for(var i=new y(null,null),n=i,o=i;;){var s=r(t,e.key);if(s<0){if(null===e.left)break;if(r(t,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,null===(e=a).left)break}o.left=e,o=e,e=e.left}else{if(!(s>0))break;if(null===e.right)break;if(r(t,e.right.key)>0){a=e.right;if(e.right=a.left,a.left=e,null===(e=a).right)break}n.right=e,n=e,e=e.right}}return n.right=e.left,o.left=e.right,e.left=i.right,e.right=i.left,e}function v(t,e,r,i){var n=new y(t,e);if(null===r)return n.left=n.right=null,n;var o=i(t,(r=m(t,r,i)).key);return o<0?(n.left=r.left,n.right=r,r.left=null):o>=0&&(n.right=r.right,n.left=r,r.right=null),n}function _(t,e,r){var i=null,n=null;if(e){var o=r((e=m(t,e,r)).key,t);0===o?(i=e.left,n=e.right):o<0?(n=e.right,e.right=null,i=e):(i=e.left,e.left=null,n=e)}return{left:i,right:n}}function x(t,e,r,i,n){if(t){i(e+(r?"└── ":"├── ")+n(t)+"\n");var o=e+(r?"    ":"│   ");t.left&&x(t.left,o,!1,i,n),t.right&&x(t.right,o,!0,i,n)}}var b=function(){function t(t){void 0===t&&(t=d),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=v(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var r=new y(t,e);null===this._root&&(r.left=r.right=null,this._size++,this._root=r);var i=this._comparator,n=m(t,this._root,i),o=i(t,n.key);return 0===o?this._root=n:(o<0?(r.left=n.left,r.right=n,n.left=null):o>0&&(r.right=n.right,r.left=n,n.right=null),this._size++,this._root=r),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,r){var i;return null===e?null:0===r(t,(e=m(t,e,r)).key)?(null===e.left?i=e.right:(i=m(t,e.left,r)).right=e.right,this._size--,i):e},t.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=m(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){for(var e=this._root,r=this._comparator;e;){var i=r(t,e.key);if(0===i)return e;e=i<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=m(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){for(var e=this._root,r=this._comparator;e;){var i=r(t,e.key);if(0===i)return!0;e=i<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){for(var r=this._root,i=[],n=!1;!n;)null!==r?(i.push(r),r=r.left):0!==i.length?(r=i.pop(),t.call(e,r),r=r.right):n=!0;return this},t.prototype.range=function(t,e,r,i){for(var n=[],o=this._comparator,s=this._root;0!==n.length||s;)if(s)n.push(s),s=s.left;else{if(o((s=n.pop()).key,e)>0)break;if(o(s.key,t)>=0&&r.call(i,s))return this;s=s.right}return this},t.prototype.keys=function(){var t=[];return this.forEach((function(e){var r=e.key;return t.push(r)})),t},t.prototype.values=function(){var t=[];return this.forEach((function(e){var r=e.data;return t.push(r)})),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},t.prototype.at=function(t){for(var e=this._root,r=!1,i=0,n=[];!r;)if(e)n.push(e),e=e.left;else if(n.length>0){if(e=n.pop(),i===t)return e;i++,e=e.right}else r=!0;return null},t.prototype.next=function(t){var e=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var i=this._comparator;e;){var n=i(t.key,e.key);if(0===n)break;n<0?(r=e,e=e.left):e=e.right}return r},t.prototype.prev=function(t){var e=this._root,r=null;if(null!==t.left){for(r=t.left;r.right;)r=r.right;return r}for(var i=this._comparator;e;){var n=i(t.key,e.key);if(0===n)break;n<0?e=e.left:(r=e,e=e.right)}return r},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return function(t){var e=t,r=[],i=!1,n=new y(null,null),o=n;for(;!i;)e?(r.push(e),e=e.left):r.length>0?e=(e=o=o.next=r.pop()).right:i=!0;return o.next=null,n.next}(this._root)},t.prototype.load=function(t,e,r){void 0===e&&(e=[]),void 0===r&&(r=!1);var i=t.length,n=this._comparator;if(r&&S(t,e,0,i-1,n),null===this._root)this._root=w(t,e,0,i),this._size=i;else{var o=function(t,e,r){var i=new y(null,null),n=i,o=t,s=e;for(;null!==o&&null!==s;)r(o.key,s.key)<0?(n.next=o,o=o.next):(n.next=s,s=s.next),n=n.next;null!==o?n.next=o:null!==s&&(n.next=s);return i.next}(this.toList(),function(t,e){for(var r=new y(null,null),i=r,n=0;n<t.length;n++)i=i.next=new y(t[n],e[n]);return i.next=null,r.next}(t,e),n);i=this._size+i,this._root=E({head:o},0,i)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return x(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},t.prototype.update=function(t,e,r){var i=this._comparator,n=_(t,this._root,i),o=n.left,s=n.right;i(t,e)<0?s=v(e,r,s,i):o=v(e,r,o,i),this._root=function(t,e,r){return null===e?t:(null===t||((e=m(t.key,e,r)).left=t),e)}(o,s,i)},t.prototype.split=function(t){return _(t,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var t,e,r;return g(this,(function(i){switch(i.label){case 0:t=this._root,e=[],r=!1,i.label=1;case 1:return r?[3,6]:null===t?[3,2]:(e.push(t),t=t.left,[3,5]);case 2:return 0===e.length?[3,4]:[4,t=e.pop()];case 3:return i.sent(),t=t.right,[3,5];case 4:r=!0,i.label=5;case 5:return[3,1];case 6:return[2]}}))},t}();function w(t,e,r,i){var n=i-r;if(n>0){var o=r+Math.floor(n/2),s=t[o],a=e[o],l=new y(s,a);return l.left=w(t,e,r,o),l.right=w(t,e,o+1,i),l}return null}function E(t,e,r){var i=r-e;if(i>0){var n=e+Math.floor(i/2),o=E(t,e,n),s=t.head;return s.left=o,t.head=t.head.next,s.right=E(t,n+1,r),s}return null}function S(t,e,r,i,n){if(!(r>=i)){for(var o=t[r+i>>1],s=r-1,a=i+1;;){do{s++}while(n(t[s],o)<0);do{a--}while(n(t[a],o)>0);if(s>=a)break;var l=t[s];t[s]=t[a],t[a]=l,l=e[s],e[s]=e[a],e[a]=l}S(t,e,r,a,n),S(t,e,a+1,i,n)}}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function I(t,e,r){return e&&C(t.prototype,e),r&&C(t,r),t}var P=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},M=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var r=t.ll.x<e.ll.x?e.ll.x:t.ll.x,i=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:r,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:i,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},L=Number.EPSILON;void 0===L&&(L=Math.pow(2,-52));var R=L*L,T=function(t,e){if(-L<t&&t<L&&-L<e&&e<L)return 0;var r=t-e;return r*r<R*t*e?0:t<e?-1:1},O=function(){function t(){k(this,t),this.reset()}return I(t,[{key:"reset",value:function(){this.xRounder=new A,this.yRounder=new A}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),t}(),A=function(){function t(){k(this,t),this.tree=new b,this.round(0)}return I(t,[{key:"round",value:function(t){var e=this.tree.add(t),r=this.tree.prev(e);if(null!==r&&0===T(e.key,r.key))return this.tree.remove(t),r.key;var i=this.tree.next(e);return null!==i&&0===T(e.key,i.key)?(this.tree.remove(t),i.key):t}}]),t}(),F=new O,N=function(t,e){return t.x*e.y-t.y*e.x},z=function(t,e){return t.x*e.x+t.y*e.y},$=function(t,e,r){var i={x:e.x-t.x,y:e.y-t.y},n={x:r.x-t.x,y:r.y-t.y},o=N(i,n);return T(o,0)},j=function(t){return Math.sqrt(z(t,t))},D=function(t,e,r){var i={x:e.x-t.x,y:e.y-t.y},n={x:r.x-t.x,y:r.y-t.y};return z(n,i)/j(n)/j(i)},U=function(t,e,r){return 0===e.y?null:{x:t.x+e.x/e.y*(r-t.y),y:r}},H=function(t,e,r){return 0===e.x?null:{x:r,y:t.y+e.y/e.x*(r-t.x)}},B=function(){function t(e,r){k(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}return I(t,null,[{key:"compare",value:function(e,r){var i=t.comparePoints(e.point,r.point);return 0!==i?i:(e.point!==r.point&&e.link(r),e.isLeft!==r.isLeft?e.isLeft?1:-1:G.compare(e.segment,r.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),I(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,r=0,i=e.length;r<i;r++){var n=e[r];this.point.events.push(n),n.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var r=this.point.events[e];if(void 0===r.segment.consumedBy)for(var i=e+1;i<t;i++){var n=this.point.events[i];void 0===n.consumedBy&&(r.otherSE.point.events===n.otherSE.point.events&&r.segment.consume(n.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,r=this.point.events.length;e<r;e++){var i=this.point.events[e];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,r=new Map,i=function(i){var n,o,s,a,l,h=i.otherSE;r.set(i,{sine:(n=e.point,o=t.point,s=h.point,a={x:o.x-n.x,y:o.y-n.y},l={x:s.x-n.x,y:s.y-n.y},N(l,a)/j(l)/j(a)),cosine:D(e.point,t.point,h.point)})};return function(t,e){r.has(t)||i(t),r.has(e)||i(e);var n=r.get(t),o=n.sine,s=n.cosine,a=r.get(e),l=a.sine,h=a.cosine;return o>=0&&l>=0?s<h?1:s>h?-1:0:o<0&&l<0?s<h?-1:s>h?1:0:l<o?-1:l>o?1:0}}}]),t}(),q=0,G=function(){function t(e,r,i,n){k(this,t),this.id=++q,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=i,this.windings=n}return I(t,null,[{key:"compare",value:function(t,e){var r=t.leftSE.point.x,i=e.leftSE.point.x,n=t.rightSE.point.x,o=e.rightSE.point.x;if(o<r)return 1;if(n<i)return-1;var s=t.leftSE.point.y,a=e.leftSE.point.y,l=t.rightSE.point.y,h=e.rightSE.point.y;if(r<i){if(a<s&&a<l)return 1;if(a>s&&a>l)return-1;var u=t.comparePoint(e.leftSE.point);if(u<0)return 1;if(u>0)return-1;var p=e.comparePoint(t.rightSE.point);return 0!==p?p:-1}if(r>i){if(s<a&&s<h)return-1;if(s>a&&s>h)return 1;var c=e.comparePoint(t.leftSE.point);if(0!==c)return c;var f=t.comparePoint(e.rightSE.point);return f<0?1:f>0?-1:1}if(s<a)return-1;if(s>a)return 1;if(n<o){var g=e.comparePoint(t.rightSE.point);if(0!==g)return g}if(n>o){var y=t.comparePoint(e.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(n!==o){var d=l-s,m=n-r,v=h-a,_=o-i;if(d>m&&v<_)return 1;if(d<m&&v>_)return-1}return n>o?1:n<o||l<h?-1:l>h?1:t.id<e.id?-1:t.id>e.id?1:0}}]),I(t,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,r=this.rightSE.point,i=this.vector();if(e.x===r.x)return t.x===e.x?0:t.x<e.x?1:-1;var n=(t.y-e.y)/i.y,o=e.x+n*i.x;if(t.x===o)return 0;var s=(t.x-e.x)/i.x,a=e.y+s*i.y;return t.y===a?0:t.y<a?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),r=t.bbox(),i=M(e,r);if(null===i)return null;var n=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,a=t.rightSE.point,l=P(e,s)&&0===this.comparePoint(s),h=P(r,n)&&0===t.comparePoint(n),u=P(e,a)&&0===this.comparePoint(a),p=P(r,o)&&0===t.comparePoint(o);if(h&&l)return p&&!u?o:!p&&u?a:null;if(h)return u&&n.x===a.x&&n.y===a.y?null:n;if(l)return p&&o.x===s.x&&o.y===s.y?null:s;if(p&&u)return null;if(p)return o;if(u)return a;var c=function(t,e,r,i){if(0===e.x)return H(r,i,t.x);if(0===i.x)return H(t,e,r.x);if(0===e.y)return U(r,i,t.y);if(0===i.y)return U(t,e,r.y);var n=N(e,i);if(0==n)return null;var o={x:r.x-t.x,y:r.y-t.y},s=N(o,e)/n,a=N(o,i)/n;return{x:(t.x+a*e.x+(r.x+s*i.x))/2,y:(t.y+a*e.y+(r.y+s*i.y))/2}}(n,this.vector(),s,t.vector());return null===c?null:P(i,c)?F.round(c.x,c.y):null}},{key:"split",value:function(e){var r=[],i=void 0!==e.events,n=new B(e,!0),o=new B(e,!1),s=this.rightSE;this.replaceRightSE(o),r.push(o),r.push(n);var a=new t(n,s,this.rings.slice(),this.windings.slice());return B.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),B.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(n.checkForConsuming(),o.checkForConsuming()),r}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,r=this.windings.length;e<r;e++)this.windings[e]*=-1}},{key:"consume",value:function(e){for(var r=this,i=e;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var n=t.compare(r,i);if(0!==n){if(n>0){var o=r;r=i,i=o}if(r.prev===i){var s=r;r=i,i=s}for(var a=0,l=i.rings.length;a<l;a++){var h=i.rings[a],u=i.windings[a],p=r.rings.indexOf(h);-1===p?(r.rings.push(h),r.windings.push(u)):r.windings[p]+=u}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys,n=0,o=this.rings.length;n<o;n++){var s=this.rings[n],a=this.windings[n],l=e.indexOf(s);-1===l?(e.push(s),r.push(a)):r[l]+=a}for(var h=[],u=[],p=0,c=e.length;p<c;p++)if(0!==r[p]){var f=e[p],g=f.poly;if(-1===u.indexOf(g))if(f.isExterior)h.push(g);else{-1===u.indexOf(g)&&u.push(g);var y=h.indexOf(f.poly);-1!==y&&h.splice(y,1)}}for(var d=0,m=h.length;d<m;d++){var v=h[d].multiPoly;-1===i.indexOf(v)&&i.push(v)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(et.type){case"union":var r=0===t.length,i=0===e.length;this._isInResult=r!==i;break;case"intersection":var n,o;t.length<e.length?(n=t.length,o=e.length):(n=e.length,o=t.length),this._isInResult=o===et.numMultiPolys&&n<o;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2==1;break;case"difference":var a=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=a(t)!==a(e);break;default:throw new Error("Unrecognized operation type found ".concat(et.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,r,i){var n,o,s,a=B.comparePoints(e,r);if(a<0)n=e,o=r,s=1;else{if(!(a>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));n=r,o=e,s=-1}return new t(new B(n,!0),new B(o,!1),[i],[s])}}]),t}(),W=function(){function t(e,r,i){if(k(this,t),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var n=F.round(e[0][0],e[0][1]);this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};for(var o=n,s=1,a=e.length;s<a;s++){if("number"!=typeof e[s][0]||"number"!=typeof e[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=F.round(e[s][0],e[s][1]);l.x===o.x&&l.y===o.y||(this.segments.push(G.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}n.x===o.x&&n.y===o.y||this.segments.push(G.fromRing(o,n,this))}return I(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,r=this.segments.length;e<r;e++){var i=this.segments[e];t.push(i.leftSE),t.push(i.rightSE)}return t}}]),t}(),Y=function(){function t(e,r){if(k(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new W(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,n=e.length;i<n;i++){var o=new W(e[i],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=r}return I(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,r=this.interiorRings.length;e<r;e++)for(var i=this.interiorRings[e].getSweepEvents(),n=0,o=i.length;n<o;n++)t.push(i[n]);return t}}]),t}(),J=function(){function t(e,r){if(k(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,n=e.length;i<n;i++){var o=new Y(e[i],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=r}return I(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,r=this.polys.length;e<r;e++)for(var i=this.polys[e].getSweepEvents(),n=0,o=i.length;n<o;n++)t.push(i[n]);return t}}]),t}(),V=function(){function t(e){k(this,t),this.events=e;for(var r=0,i=e.length;r<i;r++)e[r].segment.ringOut=this;this.poly=null}return I(t,null,[{key:"factory",value:function(e){for(var r=[],i=0,n=e.length;i<n;i++){var o=e[i];if(o.isInResult()&&!o.ringOut){for(var s=null,a=o.leftSE,l=o.rightSE,h=[a],u=a.point,p=[];s=a,a=l,h.push(a),a.point!==u;)for(;;){var c=a.getAvailableLinkedEvents();if(0===c.length){var f=h[0].point,g=h[h.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(f.x,",")+" ".concat(f.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(1===c.length){l=c[0].otherSE;break}for(var y=null,d=0,m=p.length;d<m;d++)if(p[d].point===a.point){y=d;break}if(null===y){p.push({index:h.length,point:a.point});var v=a.getLeftmostComparator(s);l=c.sort(v)[0].otherSE;break}var _=p.splice(y)[0],x=h.splice(_.index);x.unshift(x[0].otherSE),r.push(new t(x.reverse()))}r.push(new t(h))}}return r}}]),I(t,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],r=1,i=this.events.length-1;r<i;r++){var n=this.events[r].point,o=this.events[r+1].point;0!==$(n,t,o)&&(e.push(n),t=n)}if(1===e.length)return null;var s=e[0],a=e[1];0===$(s,t,a)&&e.shift(),e.push(e[0]);for(var l=this.isExteriorRing()?1:-1,h=this.isExteriorRing()?0:e.length-1,u=this.isExteriorRing()?e.length:-1,p=[],c=h;c!=u;c+=l)p.push([e[c].x,e[c].y]);return p}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,r=this.events.length;e<r;e++){var i=this.events[e];B.compare(t,i)>0&&(t=i)}for(var n=t.segment.prevInResult(),o=n?n.prevInResult():null;;){if(!n)return null;if(!o)return n.ringOut;if(o.ringOut!==n.ringOut)return o.ringOut.enclosingRing()!==n.ringOut?n.ringOut:n.ringOut.enclosingRing();n=o.prevInResult(),o=n?n.prevInResult():null}}}]),t}(),X=function(){function t(e){k(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return I(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,r=this.interiorRings.length;e<r;e++){var i=this.interiorRings[e].getGeom();null!==i&&t.push(i)}return t}}]),t}(),Z=function(){function t(e){k(this,t),this.rings=e,this.polys=this._composePolys(e)}return I(t,[{key:"getGeom",value:function(){for(var t=[],e=0,r=this.polys.length;e<r;e++){var i=this.polys[e].getGeom();null!==i&&t.push(i)}return t}},{key:"_composePolys",value:function(t){for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r];if(!n.poly)if(n.isExteriorRing())e.push(new X(n));else{var o=n.enclosingRing();o.poly||e.push(new X(o)),o.poly.addInterior(n)}}return e}}]),t}(),K=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G.compare;k(this,t),this.queue=e,this.tree=new b(r),this.segments=[]}return I(t,[{key:"process",value:function(t){var e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),r;var i=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!i)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var n=i,o=i,s=void 0,a=void 0;void 0===s;)null===(n=this.tree.prev(n))?s=null:void 0===n.key.consumedBy&&(s=n.key);for(;void 0===a;)null===(o=this.tree.next(o))?a=null:void 0===o.key.consumedBy&&(a=o.key);if(t.isLeft){var l=null;if(s){var h=s.getIntersection(e);if(null!==h&&(e.isAnEndpoint(h)||(l=h),!s.isAnEndpoint(h)))for(var u=this._splitSafely(s,h),p=0,c=u.length;p<c;p++)r.push(u[p])}var f=null;if(a){var g=a.getIntersection(e);if(null!==g&&(e.isAnEndpoint(g)||(f=g),!a.isAnEndpoint(g)))for(var y=this._splitSafely(a,g),d=0,m=y.length;d<m;d++)r.push(y[d])}if(null!==l||null!==f){var v=null;if(null===l)v=f;else if(null===f)v=l;else{v=B.comparePoints(l,f)<=0?l:f}this.queue.remove(e.rightSE),r.push(e.rightSE);for(var _=e.split(v),x=0,b=_.length;x<b;x++)r.push(_[x])}r.length>0?(this.tree.remove(e),r.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&a){var w=s.getIntersection(a);if(null!==w){if(!s.isAnEndpoint(w))for(var E=this._splitSafely(s,w),S=0,k=E.length;S<k;S++)r.push(E[S]);if(!a.isAnEndpoint(w))for(var C=this._splitSafely(a,w),I=0,P=C.length;I<P;I++)r.push(C[I])}}this.tree.remove(e)}return r}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var r=t.rightSE;this.queue.remove(r);var i=t.split(e);return i.push(r),void 0===t.consumedBy&&this.tree.insert(t),i}}]),t}(),Q="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,tt="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,et=new(function(){function t(){k(this,t)}return I(t,[{key:"run",value:function(t,e,r){et.type=t,F.reset();for(var i=[new J(e,!0)],n=0,o=r.length;n<o;n++)i.push(new J(r[n],!1));if(et.numMultiPolys=i.length,"difference"===et.type)for(var s=i[0],a=1;a<i.length;)null!==M(i[a].bbox,s.bbox)?a++:i.splice(a,1);if("intersection"===et.type)for(var l=0,h=i.length;l<h;l++)for(var u=i[l],p=l+1,c=i.length;p<c;p++)if(null===M(u.bbox,i[p].bbox))return[];for(var f=new b(B.compare),g=0,y=i.length;g<y;g++)for(var d=i[g].getSweepEvents(),m=0,v=d.length;m<v;m++)if(f.insert(d[m]),f.size>Q)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var _=new K(f),x=f.size,w=f.pop();w;){var E=w.key;if(f.size===x){var S=E.segment;throw new Error("Unable to pop() ".concat(E.isLeft?"left":"right"," SweepEvent ")+"[".concat(E.point.x,", ").concat(E.point.y,"] from segment #").concat(S.id," ")+"[".concat(S.leftSE.point.x,", ").concat(S.leftSE.point.y,"] -> ")+"[".concat(S.rightSE.point.x,", ").concat(S.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(f.size>Q)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(_.segments.length>tt)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var k=_.process(E),C=0,I=k.length;C<I;C++){var P=k[C];void 0===P.consumedBy&&f.insert(P)}x=f.size,w=f.pop()}F.reset();var L=V.factory(_.segments);return new Z(L).getGeom()}}]),t}());const rt=40075016.68557849;function it(t,e=8,r,i,n){const o=(s=i||r,a=n||r,Math.atan2(a[1]-s[1],a[0]-s[0]));var s,a;const l=2/e*Math.PI,h=new Array(e).fill(0).map(((e,i)=>{const n=(o+l*(i+1))%(2*Math.PI);return function(t,e,r){return[Math.cos(e)*r+t[0],Math.sin(e)*r+t[1]]}(r,n,t).map((t=>Math.round(t)))}));return h}const nt={WebMercatortoWGS84:(t,e)=>({lng:180*t/20037508.342789244,lat:360*Math.atan(Math.exp(e*Math.PI/20037508.342789244))/Math.PI-90}),WGS84toWebMercator:(t,e)=>{const r=20037508.342789244*t/180;let i=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return i=20037508.342789244*i/180,{x:r,y:i}}};function ot(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}function st(t){return function(t){let e=t.slice();return e.sort(ot),function(t){if(t.length<=1)return t.slice();let e=[];for(let r=0;r<t.length;r++){const i=t[r];for(;e.length>=2;){const t=e[e.length-1],r=e[e.length-2];if(!((t.x-r.x)*(i.y-r.y)>=(t.y-r.y)*(i.x-r.x)))break;e.pop()}e.push(i)}e.pop();let r=[];for(let e=t.length-1;e>=0;e--){const i=t[e];for(;r.length>=2;){const t=r[r.length-1],e=r[r.length-2];if(!((t.x-e.x)*(i.y-e.y)>=(t.y-e.y)*(i.x-e.x)))break;r.pop()}r.push(i)}return r.pop(),1==e.length&&1==r.length&&e[0].x==r[0].x&&e[0].y==r[0].y?e:[...e,...r]}(e)}(t.map((t=>({x:t[0],y:t[1]})))).map((t=>[t.x,t.y]))}const at=t=>{let e=0;for(let r=0;r<t.length;r++){e=(e<<5)-e+t.charCodeAt(r),e|=0}return Uint32Array.from([e])[0].toString(36)};function lt(t){"number"==typeof t[0]&&(t=[[[t]]]),"number"==typeof t[0][0]&&(t=[t]),"number"==typeof t[0][0][0]&&(t=[t]);return t.reduce(((t,e)=>[...t,...e]),[]).reduce(((t,e)=>[...t,...e]),[])}function ht(t,e){return t.map((t=>{if("3857"===e){const e=nt.WGS84toWebMercator(t[0],t[1]);return[e.x,e.y]}{const e=nt.WebMercatortoWGS84(t[0],t[1]);return[e.lng,e.lat]}}))}function ut(t,e){const r=t.getCanvas(),i=r.width,n=r.height,o=t=>at(JSON.stringify({properties:t.properties,layer:t.layer,geometry:t.geometry||t._geometry})),s=o(e),a=lt(e.geometry.coordinates);let l=a[0];const h=(t=>{var e=new Array(t).fill("").map(((t,e)=>e));for(let r=t-1;r>0;r--){let t=Math.floor(Math.random()*(r+1)),i=e[t];e[t]=e[r],e[r]=i}return e})(a.length);for(let e=0;e<a.length;e++){const r=h[e],u=t.project(a[r]);if(u.x>=0&&u.x<=i&&u.y>=0&&u.y<=n){const e=t.queryRenderedFeatures(u);if(e[0]&&s===o(e[0])){l=a[r];break}}}return l}function pt(t,e,r,i){const n=((t,e)=>t*(rt/(256<<e)))(r,e);let o;const s=ht(lt(t.geometry.coordinates),"3857");return o=st(s.map(((t,e)=>it(n,i,t,s[e-1],s[e+1]))).reduce(((t,e)=>[...t,...e]),[])),{type:t.type,layer:t.layer,properties:{},geometry:{type:"Polygon",coordinates:[ht(o,"4326")]}}}class ct{constructor(t,e){this._map=t,this._options=e}createSvg(t,e){let r;return"Point"===t.geometry.type?r=this.pointMarker(t,e):"LineString"===t.geometry.type||"MultiLineString"===t.geometry.type?r=this.lineMarker(t,e):"Polygon"!==t.geometry.type&&"MultiPolygon"!==t.geometry.type||(r=this.polygonMarker(t,e)),r&&(r.style.fill="rgba(0,0,0,0)"),r}pointMarker(t,e){const{bufferPixels:r,bufferSteps:i}=this._options;let n=r;const o=this._map.project(t.geometry.coordinates);let s=it(n,i,[o.x,o.y]);t.layer.paint&&t.layer.paint["circle-radius"]&&(n=t.layer.paint["circle-radius"]+r/2),s=it(n,i,[o.x,o.y]);const a=s.map((t=>this._map.unproject(t))).filter((t=>void 0!==t)).map((t=>[null==t?void 0:t.lng,null==t?void 0:t.lat])),l={type:"Feature",properties:t.properties,layer:t.layer,geometry:{type:"Polygon",coordinates:[a]}};return this.polygonMarker(l,e,t,{drawFeature:!0})}lineMarker(t,e){if(!this._map)return;let r;return r=!0===this._options.drawFeature?pt(t,this._map.getZoom(),this._options.bufferPixels,this._options.bufferSteps):{type:"Feature",properties:t.properties,layer:t.layer,geometry:"LineString"===t.geometry.type?{type:"Polygon",coordinates:[t.geometry.coordinates]}:{type:"MultiPolygon",coordinates:[t.geometry.coordinates]}},this.polygonMarker(r,e,t)}polygonMarker(t,e,r=t,i={}){const{bufferPixels:n,bufferSteps:o,labelField:s,drawFeature:a}={...this._options,...i},l=document.createElementNS("http://www.w3.org/2000/svg","polygon"),h=lt(t.geometry.coordinates).map((t=>this._map.project(t)));let u,p="";if(!0===a)"MultiPolygon"===t.geometry.type&&(t=pt(t,this._map.getZoom(),n,o)),p=h.map((t=>[t.x,t.y])).join(",");else{const t=function(t){let e={l:-1/0,r:1/0,t:-1/0,b:1/0};const r=lt(t);for(let t=0;t<r.length;t++)e.l=e.l>r[t][0]?e.l:r[t][0],e.r=e.r<r[t][0]?e.r:r[t][0],e.t=e.t>r[t][1]?e.t:r[t][1],e.b=e.b<r[t][1]?e.b:r[t][1];return e}(h.map((t=>[t.x,t.y])));p=`${`${t.l},${t.t}`} ${`${t.r},${t.t}`} ${`${t.r},${t.b}`} ${`${t.l},${t.b}`}`}return l.setAttribute("points",p),this.simulateMouseEffects(l,r),"function"==typeof s?u=s(t):void 0!==s&&(u=t.properties&&t.properties[s]),u&&(l.tabIndex=e,l.ariaLabel=u,!l.ariaLabel||(l.alt=l.ariaLabel)),l}simulateMouseEffects(t,e){const{simulateHover:r,simulateClick:i}=this._options,n=e.layer.id,o=ut(this._map,e);this.simulateHover(t,n,o),i&&this.simulateClick(t,n,o)}simulateHover(t,e,r){t.onfocus=t=>{const i=this._map.project(r);this._map.fire("mousemove",{point:i,lngLat:{lng:r[0],lat:r[1]},type:"mousemove",layerId:e,_defaultPrevented:!1,originalEvent:{...t,clientX:i.x,clientY:i.y}})},t.onblur=t=>{if(!this._map)return;const i=r.map((t=>-1*t)),n=this._map.project(i);this._map.fire("mousemove",{point:n,lngLat:{lng:i[0],lat:i[1]},type:"mousemove",layerId:e,_defaultPrevented:!1,originalEvent:{...t,clientX:n.x,clientY:n.y}})}}simulateClick(t,e,r){t.onkeydown=t=>{const i=this._map.project(r);["Enter","Space","NumpadEnter"].indexOf(t.code)>-1&&this._map.fire("click",{point:i,lngLat:{lng:r[0],lat:r[1]},type:"click",layerId:e,_defaultPrevented:!1,originalEvent:{...t,clientX:i.x,clientY:i.y}})}}}class ft{constructor(t,e){this._waitTimes={},this._container=document.createElement("span"),this._currentFeatureHash="",this.layerOptions={},this._mapLibrary=t,this._events=new t.Evented,this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg");const r=document.createElement("div");this._overlay=new this._mapLibrary.Marker(r),this._defaultOptions={...ft.DefaultOptions,...e}}addLayer(t,e){if(void 0===e.labelField)throw new Error("A label name is required for the Accessibility Control");this.layerOptions[t]={...this._defaultOptions,...e}}removeLayer(t){delete this.layerOptions[t]}addTo(t){this.onAdd(t)}remove(){this.onRemove()}onAdd(t){return this._map=t,this._initMapListeners(),this._container}onRemove(){this._clear(),this._initMapListeners(!1),delete this._map}_clear(){if(this._map){for(this._waitTimes={};this._svg.firstChild;)this._svg.removeChild(this._svg.firstChild);this._overlay.remove()}}_addFeatures(){if(!this._map)return;const t=this._map.queryRenderedFeatures(void 0,{layers:Object.keys(this.layerOptions)}),e=this._featureHash(t);if(this._currentFeatureHash!==e){this._currentFeatureHash=e,this._clear(),this._drawOverlay();const r=t.map(this._addMarker.bind(this));Promise.all(r).then((t=>this._events.fire("markersLoaded",t)))}}_featureHash(t){var e,r;return Array.isArray(t)||(t=[t]),at(t.map((t=>at((t._vectorTileFeature._geometry||0).toString()))).join()+(null===(e=this._map)||void 0===e?void 0:e.getZoom())+(null===(r=this._map)||void 0===r?void 0:r.getCenter()))}_addMarker(t,e){if(!this._map)return;const r=e+1,i=this.layerOptions[t.layer.id];let n=new ct(this._map,i).createSvg(t,r);return void 0!==n&&this._svg.appendChild(n),n}_waitEvent(t,e=500){this._waitTimes[t]=(this._waitTimes[t]||0)+e,setTimeout((()=>{void 0!==this._waitTimes[t]&&(this._waitTimes[t]=this._waitTimes[t]-e,this._waitTimes[t]<=0&&(this._waitTimes[t]=0,this._events.fire(t)))}),e)}_drawOverlay(){if(!this._map)return;const t=this._map.getCanvas(),e=this._svg;e.setAttribute("width",t.style.width),e.setAttribute("height",t.style.height);const r=document.createElement("div");return r.style.width=e.style.width,r.style.height=e.style.height,r.style.pointerEvents="none",this._svg.style.display="inline",r.appendChild(e),this._overlay=new this._mapLibrary.Marker({element:r}),this._overlay.setLngLat(this._map.getCenter()),this._overlay.setOffset([0,3]),this._overlay.addTo(this._map),this._overlay}_initMapListeners(t=!0){if(!this._map)return;const e=t?"on":"off";this._map[e]("movestart",(t=>this._svg.style.display="none"));const r=()=>{this._map&&!this._map.isMoving()&&this._waitEvent("addFeatures")};this._events[e]("addFeatures",(()=>{this._addFeatures()})),this._map[e]("moveend",(t=>r())),this._map[e]("render",(t=>r()))}}ft.DefaultOptions={labelField:"name",drawFeature:!1,bufferPixels:5,bufferSteps:8,simulateHover:!0,simulateClick:!0};return class{constructor(t,e,r={}){this._activePopups=new Map,this._map=e,this._mapLibrary=t,this._activeTooltip=void 0,this._iconMasks=new Map,this._clicks=0,this._touch=[],this._accessibility=new ft(t,{labelField:"name"}),this._accessibility.addTo(e);const i={type:"popup",multiFormatter:u};this._genericPopup=new l(void 0,{...i,...r},t),this._initMapListeners(),window.MMAAPP=e}addTooltip(t,e,r){return r={focusAfterOpen:!1,closeButton:!1,type:"tooltip",...r},this._add(t,e,r)}removeTooltip(t){return this._remove(t,"tooltip")}addPopup(t,e,r){return this._add(t,e,{type:"popup",...r})}removePopup(t){return this._remove(t,"popup")}addAccessibility(t,e){return this._accessibility.addLayer(t,e)}removeAccessibility(t){return this._accessibility.removeLayer(t)}_add(t,e,r){if(void 0===r.type)throw new Error("The _add function requires a type (popup or tooltup)");this._activePopups.get(r.type)||this._activePopups.set(r.type,new Map);const i=this._activePopups.get(r.type);if(i){let n=i.get(t);if(n)throw new Error(`Layer ${t} already has a ${r.type}, remove the other ${r.type} first`);return n=new l(e,r,this._mapLibrary),i.set(t,n),!0}}_remove(t,e){this._activePopups.get(e)||this._activePopups.set(e,new Map);const r=this._activePopups.get(e);if(r){if(!r.get(t))throw new Error(`Layer ${t} does not have a ${e}.`);return r.delete(t),!0}}_initMapListeners(){this._map.on("click",(t=>{this._clicks+=1,setTimeout((()=>{1===this._clicks&&this._click(t),this._clicks=0}),200)})),this._map.on("mousemove",(t=>{if(2!==t.originalEvent.button){this._touch.filter((e=>{const r=t.point.x-e[0],i=t.point.y-e[1];return Math.sqrt(r*r+i*i)<3})).length>0||this._mousemove(t)}})),this._map.on("touchstart",(t=>{this._touch.push([t.point.x,t.point.y]),setTimeout((()=>{this._touch=this._touch.filter((e=>t.point.x!==e[0]&&t.point.x!==e[1]))}),800)})),this._map.on("mousedown",(t=>{var e,r;if(2===t.originalEvent.button&&this._activeTooltip){const t=null===(r=null===(e=this._activePopups.get("tooltip"))||void 0===e?void 0:e.get(this._activeTooltip))||void 0===r?void 0:r.popup;t&&t.remove()}}))}_click(t){var e;const{featuresUnderMouse:r,popupLayers:i}=this._getActiveFeatures(t.point),n=this._dedupeFeatures(r.filter((t=>i.indexOf(t.layer.id)>-1)),"popup");if(n.length>1){const e=this._map;this._genericPopup.showMulti(t.lngLat,n,e,this._map,this._activePopups),this._genericPopup.popup._container.addEventListener("mouseenter",(()=>this._mousemove()))}else if(1===n.length){const r=n[0],i=this._wrapCoords(t,"Point"===r.geometry.type?r.geometry.coordinates.slice():[t.lngLat.lng,t.lngLat.lat]),o=null===(e=this._activePopups.get("popup"))||void 0===e?void 0:e.get(r.layer.id);if(o){const t=o.options.context||this._map;o.show(i,r,t,this._map),o.popup._container.addEventListener("mouseenter",(()=>this._mousemove()))}}}_quickHash(t){let e=0;for(var r=0;r<t.length;r++){e=(e<<5)-e+t.charCodeAt(r),e&=e}return e.toString(32)}_mousemove(t){var e;if(!t)return void(this._activeTooltipPopup&&this._activeTooltipPopup.popup.remove());const{featuresUnderMouse:r,popupLayers:i,tooltipLayers:n}=this._getActiveFeatures(t.point);const o=r.filter((t=>i.indexOf(t.layer.id)>-1)).map((t=>{var e,r;return(null===(r=null===(e=this._activePopups.get("popup"))||void 0===e?void 0:e.get(t.layer.id))||void 0===r?void 0:r.options.pointer)||"pointer"}))[0]||"";o!==this._map.getCanvas().getAttribute("style")&&(this._map.getCanvas().style.cursor=o);const s=this._dedupeFeatures(r.filter((t=>n.indexOf(t.layer.id)>-1)),"tooltip")[0],a=s&&this._quickHash(JSON.stringify(s.toJSON()));if(this._activeTooltip&&this._activeTooltip!==a&&this._activeTooltipPopup&&this._activeTooltipPopup.popup.remove(),s&&this._activeTooltip!==a){const r=this._wrapCoords(t,"Point"===s.geometry.type?s.geometry.coordinates.slice():[t.lngLat.lng,t.lngLat.lat]),i=null===(e=this._activePopups.get("tooltip"))||void 0===e?void 0:e.get(s.layer.id);if(i){this._activeTooltip=a,this._activeTooltipPopup=i;const e=i.options.context||this._map;i.show(r,s,e,this._map),"Point"!==s.geometry.type&&"mousemove"===t.originalEvent.type&&i.popup.trackPointer(),i.popup.once("close",(()=>{this._activeTooltip=void 0,this._activeTooltipPopup=void 0}))}}}_getActiveFeatures(t){var e,r;const i=[...(null===(e=this._activePopups.get("popup"))||void 0===e?void 0:e.keys())||[]],n=[...(null===(r=this._activePopups.get("tooltip"))||void 0===r?void 0:r.keys())||[]],o=[...i,...n].filter(((t,e,r)=>r.indexOf(t)===e));return{featuresUnderMouse:this._getAllFeatures(t,3,o),popupLayers:i,tooltipLayers:n,activeLayers:o}}_wrapCoords(t,e){for(;Math.abs(t.lngLat.lng-e[0])>180;)e[0]+=t.lngLat.lng>e[0]?360:-360;return{lng:e[0],lat:e[1]}}_getAllFeatures(e,r,i){const n=[[e.x-r,e.y-r],[e.x+r,e.y+r]];return this._map.queryRenderedFeatures(n,{layers:i.map((t=>t)).filter((t=>Object.keys(this._map.style._layers).indexOf(t)>-1))}).filter((r=>{if("symbol"===r.layer.type){const a=this._map.getLayer(r.layer.id);if(!a)return!1;const l=a.layout._values["icon-image"].evaluate(r,r.state,null,this._map.style._availableImages).name,h=this._map.style.getImage(l);let u=this._iconMasks.get(l);if(u||(u=new t(l,this._map,{}),this._iconMasks.set(l,u)),h&&u){var i,n=h.pixelRatio||1,o=[(i=Array.isArray(r.geometry.coordinates[0])?this._map.project(r.geometry.coordinates[0]):this._map.project(r.geometry.coordinates)).x-h.data.width/2/n,i.y-h.data.height/2/n],s=[Math.floor((e.x-o[0])*n),Math.floor((e.y-o[1])*n)];return u.readCoord(s[0],s[1],3)}return!0}return!0})).filter((t=>!0))}_dedupeFeatures(t,e="popup"){const r={};return t.forEach((t=>{var i,n;const o=(null===(n=null===(i=this._activePopups.get(e))||void 0===i?void 0:i.get(t.layer.id))||void 0===n?void 0:n.options.primaryKeys)||[];let s=t.layer.id;o.length?s+=JSON.stringify(Object.keys(t.properties).filter((t=>o.indexOf(t)>-1)).map((e=>[e,t.properties[e]])).reduce(((t,e)=>({...t,[e[0]]:e[1]})),{})):s+=JSON.stringify(t.properties);const a=(t=>{let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return new Uint32Array([e])[0].toString(36)})(s);if(r[a]){const e=r[a].geometry;"Point"!==e.type&&"LineString"!==e.type&&"Polygon"!==e.type||(e.type="Multi"+e.type,e.coordinates=[e.coordinates]),"MultiPoint"!==e.type&&"MultiLineString"!==e.type&&"MultiPolygon"!==e.type||t.geometry.type===e.type.replace(/^Multi/g,"")&&(e.coordinates.push(t.geometry.coordinates),r[a].geometry=e)}else r[a]=t})),Object.keys(r).map((t=>r[t]))}}}));
//# sourceMappingURL=interactivity.min.js.map
